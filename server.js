const WebSocket = require('ws');
const http = require('http');

// Создаем HTTP-сервер
const server = http.createServer((req, res) => {
  res.writeHead(200, { 'Content-Type': 'text/plain' });
  res.end('Сервер технической поддержки запущен\n');
});

// Создаем WebSocket-сервер, привязанный к нашему HTTP-серверу
const wss = new WebSocket.Server({ server });

// Обрабатываем события подключения
wss.on('connection', (ws) => {
  console.log('Клиент подключился');

  // Отправляем приветственное сообщение сразу после подключения
  ws.send('Здравствуйте, уважаемый клиент. Чем я могу вам помочь?');

  // Обрабатываем получение сообщений от клиента
  ws.on('message', (message) => {
    console.log(`Получено сообщение: ${message}`);

    // Пример обработки различных сообщений на русском языке
    if (message.includes('Помощь')) {
      ws.send('Я могу помочь с любыми вопросами о вашем аккаунте или услугах.');
    } else if (message.includes('Проблема')) {
      ws.send('Пожалуйста, опишите подробнее вашу проблему, и мы постараемся помочь.');
    } else if (message.includes('Оплата')) {
      ws.send('Информация о вашем балансе доступна в личном кабинете. Хотите узнать как его пополнить?');
    } else if (message.includes('До свидания')) {
      ws.send('Спасибо, что обратились в службу поддержки. Всего доброго!');
      ws.close();
    } else {
      ws.send('К сожалению, я не понял ваш запрос. Попробуйте задать вопрос иначе.');
    }
  });

  // Обрабатываем закрытие соединения
  ws.on('close', () => {
    console.log('Клиент отключился');
  });
});

// Запускаем сервер на порту 8080
server.listen(8080, () => {
  console.log('Сервер запущен на http://localhost:8080');
});